# 1장. 도메인 모델 시작하기

## 1.1 도메인이란?

### 도메인: 소프트웨어로 해결하고자 하는 문제 영역

- 도메인은 여러 하위 도메인으로 구성된다.
- 한 하위 도메인은 다른 하위 도메인과 연동하여 완전한 기능을 제공한다.
  - ex) 고객이 물건을 구매하면 주문, 결제, 배송, 혜택 하위 도메인의 기능이 엮이게 된다.
- 특정 도메인을 위한 소프트웨어라고 해서 모든 기능을 직접 구현하는 것은 아니다.
  - ex) 결제: 외부 PG, 배송: 외부 배송 시스템

**하위 도메인을 어떻게 구성할지 여부는 상황에 따라 달라진다.**

<br>

## 1.2 도메인 전문가와 개발자 간 지식 공유

개발자는 요구사항을 분석하고 설계하여 코드를 작성하며 테스트하고 배포한다. 요구사항 분석은 첫 단추와 같지만, 현실에서 단추를 푸는 것과는 다르게 작성한 코드를 고치려면 많은 노력이 든다.

따라서 **요구사항을 올바르게 이해하는 것이 중요하다.**

그 중 간단한 방법은 **⭐ 개발자와 전문가(현업)과 직접 대화하는 것이다.**

> **"Garbage in, Garbage out"**
>
> 잘못된 값이 들어가면 잘못된 결과가 나온다.

<br>

## 1.3 도메인 모델

도메인 모델은 특정 도메인을 개념적으로 표현한 것이다.

도메인 모델은 기본적으로 도메인 자체를 이해하기 위한 개념 모델로, 도메인을 이해하는 데 도움이 된다면 표현 방식이 무엇인지는 중요하지 않다.

### 하위 도메인과 모델

- 도메인은 다수의 하위 도메인으로 구성된다.
- 각 하위 도메인이 다루는 영역은 서로 다르기 때문에 같은 용어라도 하위 도메인마다 의미가 달라질 수 있다.
  - ex) 주문 도메인에서의 상품 != 배송 도메인에서의 상품: 고객에게 실제 배송되는 물리적인 상품

모델의 각 구성요소는 특정 도메인으로 한정할 때 비로소 의미가 완전해지기 때문에 각 하위 도메인마다 별도로 모델을 만들어야 한다.

<br>

## 1.4 도메인 모델 패턴

### 아키텍처 구성

| **영역**           | **설명**                                                                                                                            |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------- |
| UI or Presentation | 사용자의 요청을 처리하고 사용자에게 정보를 보여준다. 여기서 사용자는 소프트웨어를 사용하는 사람뿐만 아니라 외부 시스템일 수도 있다. |
| Application        | 사용자가 요청한 기능을 실행한다. 업무 로직을 직접 구현하지 않으며 도메인 계층을 조합해서 기능을 실행한다.                           |
| ⭐ Domain          | 시스템이 제공할 도메인 규칙을 구현한다.                                                                                             |
| Infrastructure     | 데이터베이스나 메시징 시스템과 같은 외부 시스템과의 연동을 처리한다.                                                                |

> **마틴 파울러의 도메인 모델 패턴**
>
> 아키텍처 상의 도메인 계층을 객체 지향 기법으로 구현하는 패턴

도메인 계층은 도메인의 핵심 규칙을 구현한다.

- ex) _주문 도메인: 주문 취소는 배송 전에만 할 수 있다._

-> 도메인 계층에 구현한다.

핵심 규칙을 구현한 코드는 도메인 모델에만 위치하기 때문에 규칙이 바뀌거나 규칙을 확장해야 할 때 다른 코드에 영향을 덜 주고 변경 내역을 모델에 반영할 수 있게 된다.

### 개념 모델과 구현 모델

개념 모델을 순수하게 분석한 결과물로 데이터베이스, 트랜잭션 처리, 성늘 구현 기술을 고려하지 않아 구현 시 그대로 사용할 수 없다. 그래서 개념 모델을 구현 가능한 형태의 모델로 전환하는 과정을 거치게 된다.

개념 모델을 처음부터 완벽하게 만들기는 불가능에 가까우니 **전반적인 개요를 알 수 있는 수준**으로 작성하여 도메인에 대한 전체 윤곽을 이해하는 데 집중하고, **구현하는 과정에서 개념 모델을 구현 모델로 점진적으로 발전시켜 나가야 한다.**

<br>

## 1.5 도메인 모델 도출

(주로 주문 도메인의 요구사항과 예시 코드로 구성되어 있어 가장 공감됐던 부분들을 기록한다.)

#### 요구사항#1

- 한 상품을 한 개 이상 주문할 수 있다.

-> 주문 항목을 표현하는 OrderLine 구현

```java
public class OrderLine {

    private Product product;
    private int price;
    private int quantity;
    private int amounts;

    ...
}
```

#### 요구사항#2

- 최소 한 종류 이상의 상품을 주문해야 한다.

-> Order와 OrderLine의 관계를 알려준다.

-> 주문은 최소 하나 이상의 주문 항목으로 이루어지도록 verifyAtLeastOneOrMoreOrderLines 메서드로 검증한다.

```java
public class Order {

    private List<OrderLine> orderLines;

    private Order(List<OrderLine> orderLines) {
        setOrderLines(orderLines);
    }

    private void setOrderLines(List<OrderLine> orderLines) {
        verifyAtLeastOneOrMoreOrderLines(orderLines);
        this.orderLines = orderLines;
    }

    private void verifyAtLeastOneOrMoreOrderLines(List<OrderLine> orderLines) {
        if (orderLines == null || orderLines.isEmpty()) {
            throw new IllegalArgumentException("no OrderLine");
        }
    }
}
```

### 문서화

문서화를 하는 주된 이유는 지식을 공유하기 위함이다.

상위 수준에서 정리한 문서를 참조하는 것이 소프트웨어 전반을 빠르게 이해하는 데 도움이 된다. 전체 구조를 이해하고 더 깊게 이해할 필요가 있는 부분을 코드로 분석해 나가면 된다.

코드를 보면서 도메인을 깊게 이해하게 되므로 코드 자체도 문서화의 대상이 된다. **단순히 코드를 보기 좋게 작성하는 것뿐만 아니라 도메인 관전에서 코드가 도메인을 잘 표현해야 비로소 코드의 가독성이 높아지고 문서로서 코드가 의미를 갖는다.**

<br>

## 1.6 엔티티와 밸류
